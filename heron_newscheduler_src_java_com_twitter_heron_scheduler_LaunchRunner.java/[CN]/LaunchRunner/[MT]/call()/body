{
  SchedulerStateManagerAdaptor statemgr=Runtime.schedulerStateManagerAdaptor(runtime);
  TopologyAPI.Topology topology=Runtime.topology(runtime);
  String topologyName=Context.topologyName(config);
  packing.initialize(config,runtime);
  PackingPlan packedPlan=packing.pack();
  launcher.initialize(config,runtime);
  if (!launcher.prepareLaunch(packedPlan)) {
    LOG.severe(launcher.getClass().getName() + " Failed to prepare launch topology locally.");
    return false;
  }
  ExecutionEnvironment.ExecutionState executionState=launcher.updateExecutionState(createBasicExecutionState());
  ListenableFuture<Boolean> sFuture=statemgr.setExecutionState(executionState,topologyName);
  if (!NetworkUtils.awaitResult(sFuture,5,TimeUnit.SECONDS)) {
    LOG.severe("Failed to set execution state");
    return false;
  }
  ListenableFuture<Boolean> tFuture=statemgr.setTopology(trimTopology(topology),topologyName);
  if (!NetworkUtils.awaitResult(tFuture,5,TimeUnit.SECONDS)) {
    LOG.severe("Failed to set topology");
    statemgr.deleteExecutionState(topologyName);
    return false;
  }
  try {
    if (!launcher.launch(packedPlan)) {
      throw new RuntimeException(launcher.getClass().getName() + " failed ");
    }
  }
 catch (  RuntimeException e) {
    statemgr.deleteExecutionState(topologyName);
    statemgr.deleteTopology(topologyName);
    LOG.log(Level.SEVERE,"Failed to launch topology remotely",e);
    return false;
  }
  if (!launcher.postLaunch(packedPlan)) {
    LOG.severe(launcher.getClass().getName() + " failed to post launch topology locally.");
    return false;
  }
  return true;
}
