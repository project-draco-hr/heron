def create_tar(tar_filename, files, config_dir):
    with contextlib.closing(tarfile.open(tar_filename, 'w:gz')) as tar:
        for filename in files:
            if os.path.isfile(filename):
                tar.add(filename, arcname=os.path.basename(filename))
            else:
                raise Exception(('%s is not an existing file' % filename))
        if os.path.isdir(config_dir):
            tar.add(config_dir, arcname=get_heron_sandbox_conf_dir())
        else:
            raise Exception(('%s is not an existing directory' % config_dir))
