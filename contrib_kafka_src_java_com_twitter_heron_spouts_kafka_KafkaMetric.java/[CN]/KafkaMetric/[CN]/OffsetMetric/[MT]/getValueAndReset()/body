{
  long totalSpoutLag=0;
  long totalLatestTimeOffset=0;
  long totalLatestEmittedOffset=0;
  long totalLatestCommittedOffset=0;
  HashMap ret=new HashMap();
  try {
    List<PartitionManager> managedPartitions=coordinator.getMyManagedPartitions();
    for (    PartitionManager partitionManager : managedPartitions) {
      long latestTimeOffset=partitionManager.getOffsetForTimestamp(OffsetRequest.LatestTime());
      long latestEmittedOffset=partitionManager.lastCompletedOffset();
      long latestCommittedOffset=partitionManager.getCommitedTo();
      long spoutLag=latestTimeOffset - latestEmittedOffset;
      totalSpoutLag+=spoutLag;
      totalLatestTimeOffset+=latestTimeOffset;
      totalLatestEmittedOffset+=latestEmittedOffset;
      totalLatestCommittedOffset+=latestCommittedOffset;
      String strPartitionId=partitionManager.getPartitionId().toString();
      ret.put(String.format("%s/spoutLag",strPartitionId),spoutLag);
      ret.put(String.format("%s/latestTime",strPartitionId),latestTimeOffset);
      ret.put(String.format("%s/latestEmittedOffset",strPartitionId),latestEmittedOffset);
      ret.put(String.format("%s/latestCommittedOffset",strPartitionId),latestCommittedOffset);
    }
    ret.put("totalSpoutLag",totalSpoutLag);
    ret.put("totalLatestTime",totalLatestTimeOffset);
    ret.put("totalLatestEmittedOffset",totalLatestEmittedOffset);
    ret.put("totalLatestCommittedOffset",totalLatestCommittedOffset);
    lastCalculatedTotalSpoutLag=totalSpoutLag;
  }
 catch (  Exception e) {
    LOG.warn("Metrics Tick: Exception when computing kafkaOffset metric.",e);
    ret.put(String.format("metricException/%s",e.getClass().getSimpleName()),1);
  }
  return ret;
}
