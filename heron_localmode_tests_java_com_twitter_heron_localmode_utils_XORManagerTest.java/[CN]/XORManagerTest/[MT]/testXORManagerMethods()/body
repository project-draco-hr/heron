{
  long rotateIntervalNs=Constants.SECONDS_TO_NANOSECONDS * timeoutSec / nBuckets + (Constants.SECONDS_TO_NANOSECONDS * timeoutSec) % nBuckets;
  WakeableLooper looper=Mockito.mock(WakeableLooper.class);
  XORManager g=new XORManager(looper,timeoutSec,taskIds,nBuckets);
  Mockito.verify(looper).registerTimerEventInNanoSeconds(Mockito.eq(Constants.SECONDS_TO_NANOSECONDS * timeoutSec),Mockito.any(Runnable.class));
  for (int i=0; i < 100; ++i) {
    g.create(1,i,1);
  }
  for (int i=0; i < 100; ++i) {
    Assert.assertEquals(g.anchor(1,i,1),true);
    Assert.assertEquals(g.remove(1,i),true);
  }
  List<Long> things_added=new LinkedList<>();
  Random random=new Random();
  Long first_key=random.nextLong();
  g.create(1,1,first_key);
  things_added.add(first_key);
  for (int j=1; j < 100; ++j) {
    long key=random.nextLong();
    things_added.add(key);
    Assert.assertEquals(g.anchor(1,1,key),false);
  }
  for (int j=0; j < 99; ++j) {
    Assert.assertEquals(g.anchor(1,1,things_added.get(j)),false);
  }
  Assert.assertEquals(g.anchor(1,1,things_added.get(99)),true);
  Assert.assertEquals(g.remove(1,1),true);
  List<Long> one_added=new LinkedList<>();
  first_key=random.nextLong();
  g.create(1,1,first_key);
  one_added.add(first_key);
  for (int j=1; j < 100; ++j) {
    long key=random.nextLong();
    one_added.add(key);
    Assert.assertEquals(g.anchor(1,1,key),false);
  }
  g.rotate();
  Mockito.verify(looper).registerTimerEventInNanoSeconds(Mockito.eq(rotateIntervalNs),Mockito.any(Runnable.class));
  for (int j=0; j < 99; ++j) {
    Assert.assertEquals(g.anchor(1,1,one_added.get(j)),false);
  }
  Assert.assertEquals(g.anchor(1,1,one_added.get(99)),true);
  Assert.assertEquals(g.remove(1,1),true);
  List<Long> two_added=new LinkedList<>();
  first_key=random.nextLong();
  g.create(2,1,first_key);
  two_added.add(first_key);
  for (int j=1; j < 100; ++j) {
    long key=random.nextLong();
    two_added.add(key);
    Assert.assertEquals(g.anchor(2,1,key),false);
  }
  for (int i=0; i < nBuckets; i++) {
    g.rotate();
  }
  Mockito.verify(looper,Mockito.times(nBuckets + 1)).registerTimerEventInNanoSeconds(Mockito.eq(rotateIntervalNs),Mockito.any(Runnable.class));
  for (int j=0; j < 100; ++j) {
    Assert.assertEquals(g.anchor(2,1,two_added.get(j)),false);
  }
  Assert.assertEquals(g.remove(2,1),false);
}
