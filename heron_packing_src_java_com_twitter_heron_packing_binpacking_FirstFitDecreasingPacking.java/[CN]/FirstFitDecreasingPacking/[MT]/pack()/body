{
  Map<String,List<String>> ffdAllocation=getFFDAllocation();
  if (ffdAllocation == null) {
    return null;
  }
  Map<String,PackingPlan.ContainerPlan> containerPlanMap=new HashMap<>();
  Map<String,Long> ramMap=TopologyUtils.getComponentRamMapConfig(topology);
  List<TopologyAPI.Config.KeyValue> topologyConfig=topology.getTopologyConfig().getKvsList();
  int paddingPercentage=Integer.parseInt(TopologyUtils.getConfigWithDefault(topologyConfig,com.twitter.heron.api.Config.TOPOLOGY_CONTAINER_PADDING_PERCENTAGE,Integer.toString(DEFAULT_CONTAINER_PADDING_PERCENTAGE)));
  long topologyRam=0;
  long topologyDisk=0;
  double topologyCpu=0.0;
  for (  Map.Entry<String,List<String>> entry : ffdAllocation.entrySet()) {
    String containerId=entry.getKey();
    List<String> instanceList=entry.getValue();
    long containerRam=0;
    long containerDiskInBytes=0;
    double containerCpu=0;
    Map<String,PackingPlan.InstancePlan> instancePlanMap=new HashMap<>();
    for (    String instanceId : instanceList) {
      long instanceRam=0;
      if (ramMap.containsKey(getComponentName(instanceId))) {
        instanceRam=ramMap.get(getComponentName(instanceId));
      }
 else {
        instanceRam=instanceRamDefault;
      }
      containerRam+=instanceRam;
      long instanceDisk=instanceDiskDefault;
      containerDiskInBytes+=instanceDisk;
      double instanceCpu=instanceCpuDefault;
      containerCpu+=instanceCpu;
      PackingPlan.Resource resource=new PackingPlan.Resource(instanceCpu,instanceRam,instanceDisk);
      PackingPlan.InstancePlan instancePlan=new PackingPlan.InstancePlan(instanceId,getComponentName(instanceId),resource);
      instancePlanMap.put(instanceId,instancePlan);
    }
    containerCpu+=(paddingPercentage * containerCpu) / 100;
    containerRam+=(paddingPercentage * containerRam) / 100;
    containerDiskInBytes+=(paddingPercentage * containerDiskInBytes) / 100;
    PackingPlan.Resource resource=new PackingPlan.Resource(Math.round(containerCpu),containerRam,containerDiskInBytes);
    PackingPlan.ContainerPlan containerPlan=new PackingPlan.ContainerPlan(containerId,instancePlanMap,resource);
    containerPlanMap.put(containerId,containerPlan);
    topologyRam+=containerRam;
    topologyCpu+=Math.round(containerCpu);
    topologyDisk+=containerDiskInBytes;
  }
  topologyRam+=instanceRamDefault;
  topologyDisk+=instanceDiskDefault;
  topologyCpu+=instanceCpuDefault;
  PackingPlan.Resource resource=new PackingPlan.Resource(topologyCpu,topologyRam,topologyDisk);
  PackingPlan plan=new PackingPlan(topology.getId(),containerPlanMap,resource);
  return plan;
}
