{
  TopologyAPI.Topology topologyToRun=heronTopology.setConfig(heronConfig).setName(name).setState(TopologyAPI.TopologyState.RUNNING).getTopology();
  PhysicalPlans.PhysicalPlan pPlan=PhysicalPlanUtil.getPhysicalPlan(topologyToRun);
  LOG.info("Physical Plan: \n" + pPlan);
  SystemConfig systemConfig=getSystemConfig();
  SingletonRegistry.INSTANCE.registerSingleton(Constants.HERON_SYSTEM_CONFIG,systemConfig);
  streamExecutor=new StreamExecutor(pPlan);
  metricsExecutor=new MetricsExecutor(systemConfig);
  for (  PhysicalPlans.Instance instance : pPlan.getInstancesList()) {
    InstanceExecutor instanceExecutor=new InstanceExecutor(pPlan,instance.getInstanceId());
    streamExecutor.addInstanceExecutor(instanceExecutor);
    metricsExecutor.addInstanceExecutor(instanceExecutor);
    instanceExecutors.add(instanceExecutor);
  }
  Thread.setDefaultUncaughtExceptionHandler(new DefaultExceptionHandler());
  threadsPool.execute(metricsExecutor);
  threadsPool.execute(streamExecutor);
  for (  InstanceExecutor instanceExecutor : instanceExecutors) {
    threadsPool.execute(instanceExecutor);
  }
}
