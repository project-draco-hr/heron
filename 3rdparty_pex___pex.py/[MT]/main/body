def main():
    parser = optparse.OptionParser(usage='usage: %prog [options] output')
    parser.add_option('--entry-point', default='__main__')
    parser.add_option('--no-zip-safe', action='store_false', dest='zip_safe', default=True)
    parser.add_option('--python', default=sys.executable)
    (options, args) = parser.parse_args()
    if (len(args) == 2):
        output = args[0]
        manifest_text = open(args[1], 'r').read()
    elif (len(args) == 1):
        output = args[0]
        manifest_text = sys.stdin.read()
    else:
        parser.error("'output' positional argument is required")
        return 1
    if (manifest_text.startswith('"') and manifest_text.endswith('"')):
        manifest_text = manifest_text[1:(len(manifest_text) - 1)]
    with open(os.path.join(tempfile.mkdtemp(dir='/tmp'), 'stderr'), 'w') as x:
        x.write(manifest_text)
    manifest = parse_manifest(manifest_text)
    tmp_dir = tempfile.mkdtemp()
    try:
        interpreter = PythonInterpreter(options.python, PythonInterpreter.from_binary(options.python).identity, extras={('setuptools', '>1.0'): '3rdparty/eggs/setuptools-18.0.1-py2.py3-none-any.whl', })
        pex_builder = PEXBuilder(path=tmp_dir, interpreter=interpreter)
        pex_builder.info.zip_safe = options.zip_safe
        pex_builder.info.entry_point = options.entry_point
        pex_builder.add_source(dereference_symlinks(pkg_resources_py), os.path.join(pex_builder.BOOTSTRAP_DIR, 'pkg_resources.py'))
        for (dst, src) in manifest['modules'].iteritems():
            try:
                pex_builder.add_source(dereference_symlinks(src), dst)
            except OSError as e:
                raise Exception('Failed to add {}: {}'.format(src, e))
        for (dst, src) in manifest['resources'].iteritems():
            pex_builder.add_resource(dereference_symlinks(src), dst)
        for req in manifest.get('prebuiltLibraries', []):
            try:
                pex_builder.add_dist_location(req)
            except Exception as e:
                raise Exception('Failed to add {}: {}'.format(req, e))
        pex_builder.build(output)
    finally:
        shutil.rmtree(tmp_dir, True)
