{
  Options options=constructOptions();
  Options helpOptions=constructHelpOptions();
  CommandLineParser parser=new DefaultParser();
  CommandLine cmd=parser.parse(helpOptions,args,true);
  ;
  if (cmd.hasOption("h")) {
    usage(options);
    return;
  }
  try {
    cmd=parser.parse(options,args);
  }
 catch (  ParseException e) {
    LOG.severe("Error parsing command line options: " + e.getMessage());
    usage(options);
    System.exit(1);
  }
  Level logLevel=Level.INFO;
  if (cmd.hasOption("v")) {
    logLevel=Level.ALL;
  }
  LoggingHelper.loggerInit(logLevel,false);
  String cluster=cmd.getOptionValue("cluster");
  String role=cmd.getOptionValue("role");
  String environ=cmd.getOptionValue("environment");
  String heronHome=cmd.getOptionValue("heron_home");
  String configPath=cmd.getOptionValue("config_path");
  String configOverrideEncoded=cmd.getOptionValue("config_overrides");
  String topologyPackage=cmd.getOptionValue("topology_package");
  String topologyDefnFile=cmd.getOptionValue("topology_defn");
  String topologyJarFile=cmd.getOptionValue("topology_jar");
  TopologyAPI.Topology topology=TopologyUtils.getTopology(topologyDefnFile);
  Config config=Config.expand(Config.newBuilder().putAll(defaultConfigs(heronHome,configPath)).putAll(commandLineConfigs(cluster,role,environ)).putAll(topologyConfigs(topologyPackage,topologyJarFile,topologyDefnFile,topology)).build());
  LOG.fine("Static config loaded successfully ");
  LOG.fine(config.toString());
  String statemgrClass=Context.stateManagerClass(config);
  IStateManager statemgr=(IStateManager)Class.forName(statemgrClass).newInstance();
  String launcherClass=Context.launcherClass(config);
  ILauncher launcher=(ILauncher)Class.forName(launcherClass).newInstance();
  String packingClass=Context.packingClass(config);
  IPacking packing=(IPacking)Class.forName(packingClass).newInstance();
  String uploaderClass=Context.uploaderClass(config);
  IUploader uploader=(IUploader)Class.forName(uploaderClass).newInstance();
  String topologyName=topology.getName();
  boolean isSuccessful=false;
  URI packageURI=null;
  try {
    statemgr.initialize(config);
    boolean isValid=validateSubmit(statemgr,topologyName);
    if (isValid) {
      LOG.log(Level.INFO,"Topology {0} to be submitted",topologyName);
      packageURI=uploadPackage(config,uploader);
      if (packageURI == null) {
        LOG.severe("Failed to upload package.");
      }
 else {
        isSuccessful=submitTopology(config,topology,statemgr,launcher,packing,packageURI);
      }
    }
  }
  finally {
    if (!isSuccessful) {
      if (packageURI != null) {
        uploader.undo();
      }
    }
    uploader.close();
    packing.close();
    launcher.close();
    statemgr.close();
  }
  if (!isSuccessful) {
    LOG.log(Level.SEVERE,"Failed to submit topology {0}. Exiting",topologyName);
    System.exit(1);
  }
 else {
    LOG.log(Level.INFO,"Topology {0} submitted successfully",topologyName);
    System.exit(0);
  }
}
