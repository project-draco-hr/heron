{
  long startTime=System.nanoTime();
synchronized (pendingOffsets) {
    pendingOffsets.remove(offset);
  }
  if (spoutConfig.shouldReplay) {
    currentKafkaOffset.set(offset);
  }
 else   if (spoutConfig.maxFailedTupleCount > 0 && failedTuples.size() < spoutConfig.maxFailedTupleCount) {
    try {
      Message failedMessage=readMessageAtOffset(offset);
      if (failedMessage != null) {
        Iterable<List<Object>> tuples=deserializePayload(Utils.toByteArray(failedMessage.payload()),offset);
        if (tuples != null) {
synchronized (failedTuples) {
            for (            List<Object> tuple : tuples) {
              failedTuples.addLast(new AbstractMap.SimpleEntry<Long,List<Object>>(offset,tuple));
            }
          }
        }
      }
    }
 catch (    Exception e) {
      LOG.error("Caught exception when trying to read from kafka ",e);
      fetchExceptions.incr();
    }
  }
  long endTime=System.nanoTime();
  nsInFail.incrBy(endTime - startTime);
}
