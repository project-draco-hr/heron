{
  ArrayList<KafkaMessageId> emittedIds=new ArrayList<>();
  LinkedList<Map.Entry<Long,List<Object>>> copyTuples=new LinkedList<>();
synchronized (failedTuples) {
    copyTuples=new LinkedList<>(failedTuples);
    failedTuples.clear();
  }
  Iterator<Map.Entry<Long,List<Object>>> iter=copyTuples.iterator();
  while (iter.hasNext()) {
    Map.Entry<Long,List<Object>> tupleAndOffset=iter.next();
    emittedIds.add(emitMessage(tupleAndOffset.getValue(),tupleAndOffset.getKey(),collector));
  }
  return emittedIds;
}
