def runTest(test, topologyName, params):
    ' Runs the test for one topology '
    try:
        submitTopology(params['cliPath'], params['cluster'], params['testJarPath'], params['topologyClassPath'], params['topologyName'], params['readFile'], params['outputFile'])
    except Exception as e:
        logging.error('Failed to submit %s topology: %s', topologyName, str(e))
        return False
    logging.info('Successfully submitted %s topology', topologyName)
    processList = getProcesses()
    while (not processExists(processList, HERON_STMGR_CMD)):
        processList = getProcesses()
    try:
        with open('temp.txt', 'w') as f:
            for line in TEST_INPUT:
                f.write(line)
    except Exception as e:
        logging.error('Failed to write to temp.txt file')
        return False
    time.sleep(30)
    if (test == 'KILL_TMASTER'):
        print 'Executing kill tmaster'
        restartShard(params['cliPath'], params['cluster'], params['topologyName'], TMASTER_SHARD)
    elif (test == 'KILL_STMGR'):
        print 'Executing kill stmgr'
        stmgrPid = getPid(('%s-%d' % (STMGR, NON_TMASTER_SHARD)), params['workingDirectory'])
        killProcess(stmgrPid)
    elif (test == 'KILL_METRICSMGR'):
        print 'Executing kill metrics manager'
        metricsmgrPid = getPid(('%s-%d' % (HERON_METRICSMGR, NON_TMASTER_SHARD)), params['workingDirectory'])
        killProcess(metricsmgrPid)
    elif (test == 'KILL_STMGR_METRICSMGR'):
        print 'Executing kill stmgr metrics manager'
        stmgrPid = getPid(('%s-%d' % (STMGR, NON_TMASTER_SHARD)), params['workingDirectory'])
        killProcess(stmgrPid)
        metricsmgrPid = getPid(('%s-%d' % (HERON_METRICSMGR, NON_TMASTER_SHARD)), params['workingDirectory'])
        killProcess(metricsmgrPid)
    elif (test == 'KILL_BOLT'):
        print 'Executing kill bolt'
        boltPid = getPid(('container_%d_%s' % (NON_TMASTER_SHARD, HERON_BOLT)), params['workingDirectory'])
        killProcess(boltPid)
    processList = getProcesses()
    while (not processExists(processList, HERON_STMGR_CMD)):
        processList = getProcesses()
    os.rename('temp.txt', params['readFile'])
    time.sleep(15)
    expectedResult = ''
    actualResult = ''
    retriesLeft = RETRY_COUNT
    while (retriesLeft > 0):
        retriesLeft -= 1
        expectedResult = ''
        actualResult = ''
        try:
            with open(params['readFile'], 'r') as f:
                expectedResult = f.read()
            with open(params['outputFile'], 'r') as g:
                actualResult = g.read()
        except Exception as e:
            logging.error('Failed to get expected and actual results')
            return False
        if (expectedResult == actualResult):
            break
        if (retriesLeft > 0):
            logging.info('Failed to get proper results, retrying')
            time.sleep(RETRY_INTERVAL)
    try:
        killTopology(params['cliPath'], params['cluster'], params['topologyName'])
    except Exception as e:
        logging.error('Failed to kill %s topology: %s', topologyName, str(e))
        return False
    logging.info('Successfully killed %s topology', topologyName)
    try:
        os.remove(params['readFile'])
        os.remove(params['outputFile'])
    except Exception as e:
        logging.error('Failed to delete test files')
        return False
    if (actualResult == expectedResult):
        logging.info('Actual result matched expected result')
        logging.info(('Actual result ---------- \n' + actualResult))
        logging.info(('Expected result ---------- \n' + expectedResult))
        return True
    else:
        logging.error('Actual result did not match expected result')
        logging.info(('Actual result ---------- \n' + actualResult))
        logging.info(('Expected result ---------- \n' + expectedResult))
        return False
