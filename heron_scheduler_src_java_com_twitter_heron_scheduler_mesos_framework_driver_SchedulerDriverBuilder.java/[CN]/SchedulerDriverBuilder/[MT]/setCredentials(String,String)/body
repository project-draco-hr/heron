{
  if (principal == null || secretFile == null) {
    credential=null;
    return this;
  }
  Protos.Credential.Builder credentialBuilder=Protos.Credential.newBuilder().setPrincipal(principal);
  try {
    ByteString secretBytes=ByteString.readFrom(new FileInputStream(secretFile));
    Set<PosixFilePermission> filePermissions=Files.getPosixFilePermissions(Paths.get(secretFile));
    if (filePermissions.contains(PosixFilePermission.OTHERS_READ) || filePermissions.contains(PosixFilePermission.OTHERS_WRITE)) {
      LOG.warning("Secret file $secretFile should not be globally accessible.");
    }
    credentialBuilder.setSecret(secretBytes);
  }
 catch (  IOException e) {
    LOG.log(Level.SEVERE,"Error reading authentication secret from file: " + secretFile,e);
  }
  credential=credentialBuilder.build();
  return this;
}
