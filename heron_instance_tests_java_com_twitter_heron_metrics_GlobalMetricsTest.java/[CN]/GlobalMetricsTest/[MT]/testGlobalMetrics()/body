{
  MetricsCollector fakeCollector=new MetricsCollector(new FakeWakeableLooper(),null);
  TopologyContext fakeContext=new TopologyContextImpl(new HashMap<String,Object>(),TopologyAPI.Topology.getDefaultInstance(),new HashMap<Integer,String>(),0,fakeCollector);
  GlobalMetrics.init(fakeContext,5);
  GlobalMetrics.incr("mycounter");
  Object value=GlobalMetrics.getUnderlyingCounter().getValueAndReset();
  assertTrue(value instanceof Map);
  Map<String,Object> metricsContent=(Map<String,Object>)value;
  assertTrue(metricsContent.containsKey("mycounter"));
  assertEquals(1,metricsContent.size());
  assertEquals(1L,metricsContent.get("mycounter"));
  GlobalMetrics.incr("mycounter1");
  GlobalMetrics.incr("mycounter2");
  GlobalMetrics.incr("mycounter1");
  metricsContent=(Map<String,Object>)GlobalMetrics.getUnderlyingCounter().getValueAndReset();
  assertTrue(metricsContent.containsKey("mycounter"));
  assertTrue(metricsContent.containsKey("mycounter1"));
  assertTrue(metricsContent.containsKey("mycounter2"));
  assertEquals(3L,metricsContent.size());
  assertEquals(0L,metricsContent.get("mycounter"));
  assertEquals(1L,metricsContent.get("mycounter2"));
  assertEquals(2L,metricsContent.get("mycounter1"));
}
